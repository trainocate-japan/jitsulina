---
sidebar: auto
title: 目次
---

### 実務で使えるLinux 入門編 演習手順
演習2【基本的なシェルの操作】
==

## 概要
- ワイルドカードによる複数ファイルの一括処理方法を学びます
- リダイレクションとパイプライン、連続実行による効率的なコマンド利用方法を学びます
- エイリアスの利用方法を学びます
## 所要時間
30分
## 実施内容
- 演習：ワイルドカードの操作
- 演習：出力リダイレクション（標準エラーの取り扱い）
- 演習：出力リダイレクション（標準出力の取り扱い）
- 演習：パイプライン
- 演習：コマンドの連続実行
- 演習：エイリアス
## 演習手順
### 演習：ワイルドカードの操作
#### 1. ec2-userのホームディレクトリに、lab2というディレクトリを作成してください。作成できたら、そのディレクトリに移動してください

  ::: details 解答例
  cd
  <br>
  mkdir lab2 
  <br>
  cd lab2
  :::

#### 1. /etcディレクトリにある、拡張子が .conf となっているファイルを全て、詳細情報も含めて表示してください

  ::: details 解答例
  ls -l /etc/*.conf
  :::

#### 1. /etcディレクトリにある、拡張子が .conf となっているファイルを全て、カレントディレクトリにコピーしてください。サブディレクトリまでは不要です

  ::: details 解答例
  cp /etc/*.conf .
  :::

### 演習：出力リダイレクション（標準エラーの取り扱い）
#### 1. ファイルコピーのコマンドを実行すると「許可がありません」というエラーが出ました。もう一度ファイルのコピーを実施し、エラーを errors.log ファイルに保管してください。再実行には、シェルのヒストリ機能を使ってください

  ::: details 解答例
  カーソルキーの上でコマンドを選択
  <br>
  表示されたコマンドに 2> errors.log を追加して実行（2の前にスペースを忘れないこと）
  <br>
  （実行されるコマンドは cp /etc/*.conf . 2> errors.log）
  :::

#### 1. コマンド実行時のエラーは、表示やファイルへの保管が不要なことがあります。その際は、/dev/null ファイルに出力すると表示も保管もせず消すことが出来ます。今度はエラーを消去してみましょう

  ::: details 解答例
  cp /etc/*.conf . 2> /dev/null
  :::

  :::tip
  /dev/null は特殊なファイルで、書き込まれたデータを全て廃棄し、読み出しても何も返しません。コマンドの出力結果やエラーを破棄する場合や、ファイルを空にしたいときによく使います
  :::

### 演習：出力リダイレクション（標準出力の取り扱い）
#### 1. lab2ディレクトリ内のファイル一覧を、files.txt に取得します。その前に、files.txtに現在時刻とユーザー名を記録してください。ユーザー名を取得するコマンドは問いません

  ::: details 解答例
  date > files.txt
  <br>
  id >> files.txt
  :::

#### 1. lab2ディレクトリ内の詳細なファイル一覧を、files.txt に追記してください。正しく保存できているかも確認してください。ファイルの先頭に、時刻と作業者情報が記載されていることも確認してください

  ::: details 解答例
  ls -l . >> files.txt
  <br>
  cat files.txt
  :::

  :::tip
  リダイレクトをうまく使うと、作業結果のファイル（今回の場合はファイル一覧の取得）に作業時間や作業者名を残すことができます
  :::

  :::warning
  リダイレクトを間違えて上書きした場合は、時刻とユーザー名の記載からやりなおしてください
  :::

### 演習：パイプライン
#### 1. lab2ディレクトリには、/etcにあった設定ファイルが複数コピーされています。このファイルの中から、server という文字が含まれているファイルの一覧を表示してください。検索の際は大文字・小文字を区別せず、文字が含まれている行の行番号も表示してください

  ::: details 解答例
  grep -in server *.conf
  :::

#### 1. 先ほどの検索結果は何行あったでしょうか？ wcコマンドに -l オプションを付けると行数を表示できます。パイプをうまく使い、wcコマンドにgrepの結果を渡してください 

  ::: details 解答例
  grep server *.conf|wc -l
  :::

#### 1. 先ほどの検索結果を、files.txtに追記してください。今回の追記の前に区切りの文字「-----」を挿入してみましょう。区切り文字は、echo "-----" を実行すると挿入できます。実行が終わったら、結果を確認してください

  ::: details 解答例
  echo "-----" >> files.txt
  <br>
  grep server *.conf >> files.txt
  <br>
  grep server *.conf|wc -l >> files.txt
  <br>
  cat files.txt
  :::

### 演習：コマンドの連続実行
#### 1. これまで行った以下の作業を1行のコマンドで実行できるよう、連続実行してください。ただし、連続実行中にエラーが出た場合はそこで実行を停止するようにしてください。ファイル名は、files2.txt としてください
  ```
  現在時刻とユーザー情報の記録
  ディレクトリ内のファイル一覧の記録
  serverという文字列を含んだファイルの表示、行数の確認と記録
  ```

  ::: details 解答例
  date > files2.txt && id >> files2.txt && ls -l >> files2.txt && echo "-----" >> files2.txt && grep -in server *.conf >> files2.txt && grep -in server *.conf|wc -l >> files2.txt 
  :::

### 演習：エイリアス
#### 1. ところで、演習の最初でcpコマンドを何度か実施した際に、ファイルの上書き確認が出ませんでした。この動作はファイルを気づかず上書きしてしまうため危険です。すでに存在しているファイルを対象にcpコマンドを実行するときは上書き確認ができるように、cpコマンドにオプションを付けて実行してください。実行するコマンドは最初のと同じで構いません。大量にファイルを処理するので、途中で実行を止めても構いません

  ::: details 解答例
  cp -i /etc/*.conf .
  :::

#### 1. コピーの対象が多くある場合で、確実に上書きしてもいいときは yes コマンドとパイプを使って y の入力を自動化することもできます。以下のコマンドを実行して、上書き確認に y を自動応答してください

  ```
  yes|cp -i /etc/*.conf .
  ```

  :::tip
  yesコマンドは、y と改行を標準出力に出力するコマンドで、シェルスクリプトでの自動化などに使います。もっともコマンドに -y オプションがある際は使わなくても構いません。ちなみに、yes コマンドを実行するとCPUの利用率が上がるため、簡易的な負荷試験でも利用されます
  :::

#### 1. ファイルをコピーする際は必ず上書き確認されるようにしたいです。cpと実行した際に、cp -i オプション付きで実行されるよう、エイリアスを設定してください。設定できたら、エイリアス一覧を表示してください

  ::: details 解答例
  alias cp='cp -i'
  <br>
  alias
  :::

#### 1. エイリアスの設定に問題がないか、コピーするファイルは何でも構わないので動作確認をしてください

  ::: details 解答例
  cp /etc/resolv.conf .
  <br>
  上書き確認が表示されればよい
  :::

  :::tip
  aliasコマンドで設定したエイリアスは操作中のシェルのみ有効なため、別のシェルを起動したりログアウトすると消えます。永続的にエイリアスを設定するには.bashrcなどの設定ファイルに書き込む必要があります
  :::

#### 1. rootユーザーでの作業は危険なため、一般ユーザーとは異なるエイリアスが設定されています。rootユーザーのエイリアス設定を確認してください。エイリアスは、rootユーザーのホームディレクトリ（/root）にある .bashrc に設定されています。なるべく少ない手順で確認できるよう、これまで学んだ手法を活用してください

  ::: details 解答例
  sudo cat /root/.bashrc|grep alias
  :::

---
[入門編の目次に戻る](../index.md
<br>

[トップページに戻る](../../index.md)